# Дипломная работа по профессии «Системный администратор»
## Автор: Зубков Данил Андреевич
---
# Содержание
- [Введение](#введение)
- [Настройка Terraform и Yandex Cloud](#настройка-terraform-и-yandex-cloud)
- [Инфраструктура](#инфраструктура)
- [Сеть](#сеть)
- [Мониторинг(Zabbix)](#мониторингzabbix)
- [Сбор логов(ELK)](#сбор-логовelk)
- [Резервное копирование](#резервное-копирование)
- [Заключение](#заключение)
---

### Введение
Ключевая задача данной работы — это разработать отказоустойчивую инфраструктуру для сайта, включающую мониторинг, сбор логов и резервное копирование основных данных. Вся инфраструктура размещается в Yandex Cloud. В качестве тестового сайта выступает приветственная страница сервера Nginx, для мониторинга использутеся Zabbix Server и Zabbix Agents2, для сбора и анализа логов используется ELK стек, в качестве технологии резервного копирования выбрано создание snapshot'ов дисков всех ВМ.  

Весь Terraform и Ansible код, а также конфиги отдельных сервисов размещены в [данном репозитории](https://github.com/DoctorZub/sys-diplom/tree/main/main). 

---
### Настройка Terraform и Yandex Cloud
Перед началом работы с облаком необходимо организовать связь между Terraform и самим облаком, в нашем случае, с Yandex Cloud. Способов получения данных для аутентификации в облаке существует несколько, в данной работе используется метод с сервисным аккаунтом и авторизованным ключом.

В облачной консоли был создан сервисный аккаунт с именем *terraform*, и выпущен авторизованный ключ. 
![Сервисный аккаунт](https://github.com/DoctorZub/sys-diplom/blob/main/main/img/auth_key.png)

Для корректной работы Terraform с Yandex Cloud авторизованный ключ должен располагаться в домашнем каталоге на рабочей станции администратора, т.е. на машине откуда будет инициализитоваться и запускать код Terraform.  
Путь к ключу указывается в файле [providers.tf](https://github.com/DoctorZub/sys-diplom/blob/main/main/providers.tf) в блоке:  
```terraform
provider "yandex" {
  cloud_id                 = var.cloud_id
  folder_id                = var.folder_id
  service_account_key_file = file("~/.authorized_key.json")
}
```
`cloud_id` - идентификатор рабочего облака;  
`folder_id` - идентификатор рабочей директории в облаке;  
Данные поля заполняются через переменные, указанные в файле [variables.tf](https://github.com/DoctorZub/sys-diplom/blob/main/main/variables.tf)

На этом настройка Terraform и Yandex Cloud завершена.

---
### Инфраструктура
Вся инфраструктура состоит из 7-ми виртуальных машин(ВМ) и 1-го балансироващика нагрузки -Application load balancer(ALB):  
- 2 ВМ с сервером Nginx *(web-a, web-b)*, на котором располагается сайт;
- 1 ВМ - бастион-сервер *(bastion)*, выступающих входной точкой для подключения по ssh ко всей инфраструктуре. Конфигурирование всем ВМ осуществляется с рабочей станции администратора по ssh(порт :22) через бастион сервер;
- 1 ВМ - Zabbix-server *(zabbix)* для мониторинга серверов *web-a и web-b*;
- 1 ВМ - сервер с Logstash *(logstash)* для получения и обработки логов серверов Nginx;
- 1 ВМ - сервер с Elasticsearch *(elastic)* для хранения логов серверов Nginx;
- 1 ВМ - сервер с Kibana *(kibana)* для визуального предстравления и анализа информации с Elasticsearch.
- ALB, настроенный на балансировку трафика между серверами *web-a и web-b*, объединенных в одну Instance Group.

---
### Сеть
---
### Мониторинг(Zabbix)
---
### Сбор логов(ELK)
---
### Резервное копирование
---
### Заключение
---

