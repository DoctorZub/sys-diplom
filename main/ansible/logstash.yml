---
- name: Установка и настройка Logstash
  hosts: logstash
  become: yes

  tasks:
    - name: Импорт ключа репозитория ELK
      apt_key:
        url: "https://artifacts.elastic.co/GPG-KEY-elasticsearch"
        state: present
    - name: Добавление репозитория ELK
      apt_repository:
        repo:
          "deb [trusted=yes] https://mirror.yandex.ru/mirrors/elastic/8/ stable main"
        state: present
        filename: elk
    - name: Обновление списка пакетов
      apt:
        update_cache: yes
  
   #  Install and Config Logstash
    - name: Установка Logstash
      package:
        name: logstash
        state: present
    - name: Настройка Logstash_1
      copy:
        src: ./configs/logstash/pipelines.yml
        dest: /etc/logstash/pipelines.yml
    - name: Настройка Logstash_2
      copy:
        src: ./configs/logstash/beat_nginx.conf
        dest: /etc/logstash/conf.d/beat_nginx.conf
    - name: Запуск Logstash
      service:
        name: logstash
        state: restarted
